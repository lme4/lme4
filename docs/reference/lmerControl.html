<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Control of Mixed Model Fitting — lmerControl • lme4</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Control of Mixed Model Fitting — lmerControl"><meta name="description" content="Construct control structures for mixed model fitting.  All arguments
  have defaults, and can be grouped into
general control parameters, most importantly optimizer,
    further restart_edge, etc;
model- or data-checking specifications, in short
    &amp;#8220;checking options&amp;#8221;, such as check.nobs.vs.rankZ, or
    check.rankX (currently not for nlmerControl);
all the parameters to be passed to the optimizer, e.g.,
    maximal number of iterations, passed via the optCtrl list
    argument.

"><meta property="og:description" content="Construct control structures for mixed model fitting.  All arguments
  have defaults, and can be grouped into
general control parameters, most importantly optimizer,
    further restart_edge, etc;
model- or data-checking specifications, in short
    &amp;#8220;checking options&amp;#8221;, such as check.nobs.vs.rankZ, or
    check.rankX (currently not for nlmerControl);
all the parameters to be passed to the optimizer, e.g.,
    maximal number of iterations, passed via the optCtrl list
    argument.

"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">lme4</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1-37.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/lmer.html">Fitting Linear Mixed-Effects Models using lme4</a></li>
    <li><a class="dropdown-item" href="../articles/lmerperf.html">lme4 performance tips</a></li>
    <li><a class="dropdown-item" href="../articles/PLSvGLS.html">PLS vs GLS for LMMs</a></li>
    <li><a class="dropdown-item" href="../articles/Theory.html">Computational Methods</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lme4/lme4/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Control of Mixed Model Fitting</h1>

      <div class="d-none name"><code>lmerControl.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Construct control structures for mixed model fitting.  All arguments
  have defaults, and can be grouped into</p><ul><li><p>general control parameters, most importantly <code>optimizer</code>,
    further <code>restart_edge</code>, etc;</p></li>
<li><p>model- or data-checking specifications, in short
    “checking options”, such as <code>check.nobs.vs.rankZ</code>, or
    <code>check.rankX</code> (currently not for <code>nlmerControl</code>);</p></li>
<li><p>all the parameters to be passed to the optimizer, e.g.,
    maximal number of iterations, passed via the <code>optCtrl</code> list
    argument.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre><code>lmerControl(optimizer = "nloptwrap",&lt;!-- % was "Nelder_Mead" till Dec.2013, --&gt;
				    &lt;!-- % then "bobyqa" till Oct 2018; CRAN till 1.1-20 (2019-02-04) --&gt;
    restart_edge = TRUE,
    boundary.tol = 1e-5,
    calc.derivs = TRUE,
    use.last.params = FALSE,
    sparseX = FALSE,
    standardize.X = FALSE,
    ## input checking options
    check.nobs.vs.rankZ = "ignore",
    check.nobs.vs.nlev = "stop",
    check.nlev.gtreq.5 = "ignore",
    check.nlev.gtr.1 = "stop",
    check.nobs.vs.nRE= "stop",
    check.rankX = c("message+drop.cols", "silent.drop.cols", "warn+drop.cols",
                    "stop.deficient", "ignore"),
    check.scaleX = c("warning","stop","silent.rescale",
                     "message+rescale","warn+rescale","ignore"),
    check.formula.LHS = "stop",
    ## convergence checking options
    check.conv.grad     = .makeCC("warning", tol = 2e-3, relTol = NULL),
    check.conv.singular = .makeCC(action = "message", tol = formals(isSingular)$tol),
    check.conv.hess     = .makeCC(action = "warning", tol = 1e-6),
    ## optimizer args
    optCtrl = list(),
    mod.type = "lmer"
)

glmerControl(optimizer = c("bobyqa", "Nelder_Mead"),
    restart_edge = FALSE,
    boundary.tol = 1e-5,
    calc.derivs = TRUE,
    use.last.params = FALSE,
    sparseX = FALSE,
    standardize.X = FALSE,
    ## input checking options
    check.nobs.vs.rankZ = "ignore",
    check.nobs.vs.nlev = "stop",
    check.nlev.gtreq.5 = "ignore",
    check.nlev.gtr.1 = "stop",
    check.nobs.vs.nRE= "stop",
    check.rankX = c("message+drop.cols", "silent.drop.cols", "warn+drop.cols",
                    "stop.deficient", "ignore"),
    check.scaleX = c("warning","stop","silent.rescale",
                     "message+rescale","warn+rescale","ignore"),
    check.formula.LHS = "stop",
    ## convergence checking options
    check.conv.grad     = .makeCC("warning", tol = 2e-3, relTol = NULL),
    check.conv.singular = .makeCC(action = "message", tol = formals(isSingular)$tol),
    check.conv.hess     = .makeCC(action = "warning", tol = 1e-6),
    ## optimizer args
    optCtrl = list(),
    mod.type = "glmer",
    tolPwrss = 1e-7,
    compDev = TRUE,
    nAGQ0initStep = TRUE,
    check.response.not.const = "stop"
 )

nlmerControl(optimizer = "Nelder_Mead", tolPwrss = 1e-10,
             optCtrl = list())

.makeCC(action, tol, relTol, ...)</code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-optimizer">optimizer<a class="anchor" aria-label="anchor" href="#arg-optimizer"></a></dt>
<dd><p>character - name of optimizing function(s).  A
    <code><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></code> vector or list of functions: length 1 for
    <code>lmer</code> or <code>glmer</code>, possibly length 2 for <code>glmer</code>).
    Built-in optimizers are <code>"<a href="Nelder_Mead.html">Nelder_Mead</a>"</code>,
    <code>"<a href="https://rdrr.io/pkg/minqa/man/bobyqa.html" class="external-link">bobyqa</a>"</code> (from the <a href="https://CRAN.R-project.org/package=minqa" class="external-link"><span class="pkg">minqa</span></a> package),
    <code>"<a href="nloptwrap.html">nlminbwrap</a>"</code> (using base <span style="R">R</span>'s <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code>) and the
    default for <code>lmerControl()</code>, <code>"<a href="nloptwrap.html">nloptwrap</a>"</code>.  Any
    minimizing function that allows box constraints can be used provided
    that it</p><dl><dt>(1)</dt>
<dd><p>takes input parameters <code>fn</code> (function to be
        optimized), <code>par</code> (starting parameter values), <code>lower</code>
        and <code>upper</code> (parameter bounds)
	and <code>control</code> (control parameters, passed
        through from the <code>control</code> argument) and</p></dd>

      <dt>(2)</dt>
<dd><p>returns a list with (at least) elements <code>par</code>
        (best-fit parameters), <code>fval</code> (best-fit function value),
        <code>conv</code> (convergence code, equal to zero for
	successful convergence) and (optionally) <code>message</code>
        (informational message, or explanation of convergence failure).</p></dd>


</dl><p>Special provisions are made for <code><a href="https://rdrr.io/pkg/minqa/man/bobyqa.html" class="external-link">bobyqa</a></code>,
    <code><a href="Nelder_Mead.html">Nelder_Mead</a></code>, and optimizers wrapped in the
    <a href="https://CRAN.R-project.org/package=optimx" class="external-link"><span class="pkg">optimx</span></a> package; to use the <span class="pkg">optimx</span> optimizers (including
    <code>L-BFGS-B</code> from base <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> and
    <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code>), pass the <code>method</code> argument to
    <code>optim</code> in the <code>optCtrl</code> argument (you may
    need to load the <span class="pkg">optimx</span> package manually using
    <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a>(optimx)</code>).</p>
<p>For <code>glmer</code>, if <code>length(optimizer)==2</code>, the first element
    will be used for the preliminary (random effects parameters only)
    optimization, while the second will be used for the final (random
    effects plus fixed effect parameters) phase.  See
    <code><a href="modular.html">modular</a></code> for more information on these two phases.</p>
<p>If <code>optimizer</code> is <code>NULL</code> (at present for <code>lmer</code> only),
    all of the model structures will be set up, but no optimization will
    be done (e.g. parameters will all be returned as <code>NA</code>).</p></dd>

  <dt id="arg-calc-derivs">calc.derivs<a class="anchor" aria-label="anchor" href="#arg-calc-derivs"></a></dt>
<dd><p>logical - compute gradient and Hessian of nonlinear
    optimization solution?</p></dd>

  <dt id="arg-use-last-params">use.last.params<a class="anchor" aria-label="anchor" href="#arg-use-last-params"></a></dt>
<dd><p>logical - should the last value of the
    parameters evaluated (<code>TRUE</code>), rather than the value of the
    parameters corresponding to the minimum deviance, be returned?
    This is a "backward bug-compatibility" option; use <code>TRUE</code>
    only when trying to match previous results.</p></dd>

  <dt id="arg-sparsex">sparseX<a class="anchor" aria-label="anchor" href="#arg-sparsex"></a></dt>
<dd><p>logical - should a sparse model matrix be
    used for the fixed-effects terms?
    Currently inactive.</p></dd>

  <dt id="arg-restart-edge">restart_edge<a class="anchor" aria-label="anchor" href="#arg-restart-edge"></a></dt>
<dd><p>logical - should the optimizer
    attempt a restart when it finds a solution at the
    boundary (i.e. zero random-effect variances or perfect
    +/-1 correlations)?  (Currently only implemented for
    <code>lmerControl</code>.)</p></dd>

  <dt id="arg-boundary-tol">boundary.tol<a class="anchor" aria-label="anchor" href="#arg-boundary-tol"></a></dt>
<dd><p>numeric - within what distance of
    a boundary should the boundary be checked for a better fit?
    (Set to zero to disable boundary checking.)</p></dd>

  <dt id="arg-tolpwrss">tolPwrss<a class="anchor" aria-label="anchor" href="#arg-tolpwrss"></a></dt>
<dd><p>numeric scalar - the tolerance for declaring
    convergence in the penalized iteratively weighted residual
    sum-of-squares step.</p></dd>

  <dt id="arg-compdev">compDev<a class="anchor" aria-label="anchor" href="#arg-compdev"></a></dt>
<dd><p>logical scalar - should compiled code be
    used for the deviance evaluation during the optimization
    of the parameter estimates?</p></dd>

  <dt id="arg-nagq-initstep">nAGQ0initStep<a class="anchor" aria-label="anchor" href="#arg-nagq-initstep"></a></dt>
<dd><p>Run an initial optimization phase with
    <code>nAGQ = 0</code>. While the initial optimization usually
    provides a good starting point for subsequent fitting
    (thus increasing overall computational speed),
    setting this option to <code>FALSE</code> can be useful in cases
    where the initial phase results in bad fixed-effect estimates
    (seen most often in binomial models with <code>link="cloglog"</code>
    and offsets).</p></dd>

  <dt id="arg-check-nlev-gtreq-">check.nlev.gtreq.5<a class="anchor" aria-label="anchor" href="#arg-check-nlev-gtreq-"></a></dt>
<dd><p>character - rules for
    checking whether all random effects have &gt;= 5 levels.
    See <code>action</code>.</p></dd>

  <dt id="arg-check-nlev-gtr-">check.nlev.gtr.1<a class="anchor" aria-label="anchor" href="#arg-check-nlev-gtr-"></a></dt>
<dd><p>character - rules for checking
    whether all random effects have &gt; 1 level. See <code>action</code>.</p></dd>

  <dt id="arg-check-nobs-vs-rankz">check.nobs.vs.rankZ<a class="anchor" aria-label="anchor" href="#arg-check-nobs-vs-rankz"></a></dt>
<dd><p>character - rules for
    checking whether the number of observations is greater
    than (or greater than or equal to) the rank of the random
    effects design matrix (Z), usually necessary for
    identifiable variances.  As for <code>action</code>, with
    the addition of <code>"warningSmall"</code> and <code>"stopSmall"</code>, which run
    the test only if the dimensions of <code>Z</code> are &lt; 1e6.
    <code>nobs &gt; rank(Z)</code> will be tested for LMMs and GLMMs with
    estimated scale parameters; <code>nobs &gt;= rank(Z)</code> will be tested
    for GLMMs with fixed scale parameter.
    The rank test is done using the
    <code>method="qr"</code> option of the <code><a href="https://rdrr.io/pkg/Matrix/man/rankMatrix.html" class="external-link">rankMatrix</a></code>
    function.</p></dd>

  <dt id="arg-check-nobs-vs-nlev">check.nobs.vs.nlev<a class="anchor" aria-label="anchor" href="#arg-check-nobs-vs-nlev"></a></dt>
<dd><p>character - rules for checking whether the
    number of observations is less than (or less than or equal to) the
    number of levels of every grouping factor, usually necessary for
    identifiable variances.  As for <code>action</code>.
    <code>nobs&lt;nlevels</code> will be tested for LMMs and GLMMs with estimated
    scale parameters; <code>nobs&lt;=nlevels</code> will be tested for GLMMs with
    fixed scale parameter.</p></dd>

  <dt id="arg-check-nobs-vs-nre">check.nobs.vs.nRE<a class="anchor" aria-label="anchor" href="#arg-check-nobs-vs-nre"></a></dt>
<dd><p>character - rules for
    checking whether the number of observations is greater
    than (or greater than or equal to) the number of random-effects
    levels for each term, usually necessary for identifiable variances.
    As for <code>check.nobs.vs.nlev</code>.</p></dd>

  <dt id="arg-check-conv-grad">check.conv.grad<a class="anchor" aria-label="anchor" href="#arg-check-conv-grad"></a></dt>
<dd><p>rules for checking the gradient of the deviance
    function for convergence.  A list as returned
    by <code>.makeCC</code>, or a character string with only the action.</p></dd>

  <dt id="arg-check-conv-singular">check.conv.singular<a class="anchor" aria-label="anchor" href="#arg-check-conv-singular"></a></dt>
<dd><p>rules for checking for a singular fit,
    i.e. one where some parameters are on the boundary of the feasible
    space (for example, random effects variances equal to 0 or
    correlations between random effects equal to +/- 1.0);
    as for <code>check.conv.grad</code> above.  The default is to use
    <code><a href="isSingular.html">isSingular</a>(.., tol = *)</code>'s default.</p></dd>

  <dt id="arg-check-conv-hess">check.conv.hess<a class="anchor" aria-label="anchor" href="#arg-check-conv-hess"></a></dt>
<dd><p>rules for checking the Hessian of the deviance
    function for convergence.; as for <code>check.conv.grad</code>
    above.</p></dd>

  <dt id="arg-check-rankx">check.rankX<a class="anchor" aria-label="anchor" href="#arg-check-rankx"></a></dt>
<dd><p>character - specifying if <code><a href="https://rdrr.io/pkg/Matrix/man/rankMatrix.html" class="external-link">rankMatrix</a>(X)</code>
    should be compared with <code>ncol(X)</code> and if columns from the design
    matrix should possibly be dropped to ensure that it has full rank.
    Sometimes needed to make the model identifiable.  The options can be
    abbreviated; the three <code>"*.drop.cols"</code> options all do drop
    columns, <code>"stop.deficient"</code> gives an error when the rank is
    smaller than the number of columns where <code>"ignore"</code> does no
    rank computation, and will typically lead to less easily
    understandable errors, later.</p></dd>

  <dt id="arg-check-scalex">check.scaleX<a class="anchor" aria-label="anchor" href="#arg-check-scalex"></a></dt>
<dd><p>character - check for problematic scaling of
    columns of fixed-effect model matrix, e.g. parameters measured on
    very different scales.</p></dd>

  <dt id="arg-check-formula-lhs">check.formula.LHS<a class="anchor" aria-label="anchor" href="#arg-check-formula-lhs"></a></dt>
<dd><p>check whether specified formula has
    a left-hand side. Primarily for internal use within
    <code>simulate.merMod</code>;
    <em>use at your own risk</em> as it may allow the generation
    of unstable <code>merMod</code> objects</p></dd>

  <dt id="arg-check-response-not-const">check.response.not.const<a class="anchor" aria-label="anchor" href="#arg-check-response-not-const"></a></dt>
<dd><p>character - check that the
    response is not constant.</p></dd>


  <dt id="arg-optctrl">optCtrl<a class="anchor" aria-label="anchor" href="#arg-optctrl"></a></dt>
<dd><p>a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> of additional arguments to be
    passed to the nonlinear optimizer (see <code><a href="Nelder_Mead.html">Nelder_Mead</a></code>,
    <code><a href="https://rdrr.io/pkg/minqa/man/bobyqa.html" class="external-link">bobyqa</a></code>).  In particular, both
    <code>Nelder_Mead</code> and <code>bobyqa</code> use <code>maxfun</code> to
    specify the maximum number of function evaluations they
    will try before giving up - in contrast to
    <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></code> and <code>optimx</code>-wrapped optimizers,
    which use <code>maxit</code>. (Also see <code><a href="convergence.html">convergence</a></code>
    for details of stopping tolerances for different optimizers.)</p>
<p><em>Note:</em> All of <code><a href="lmer.html">lmer</a>()</code>, <code><a href="glmer.html">glmer</a>()</code> and
    <code><a href="nlmer.html">nlmer</a>()</code> have an optional integer argument <code>verbose</code>
    which you should raise (to a positive value) in order to get diagnostic
    console output about the optimization progress.</p></dd>

  <dt id="arg-action">action<a class="anchor" aria-label="anchor" href="#arg-action"></a></dt>
<dd><p>character - generic choices for the severity level
    of any test, with possible values</p><dl><dt>"ignore":</dt>
<dd><p>skip the test.</p></dd>

      <dt>"warning":</dt>
<dd><p>warn if test fails.</p></dd>

      <dt>"message":</dt>
<dd><p>print a message if test fails.</p></dd>

      <dt>"stop":</dt>
<dd><p>throw an error if test fails.</p></dd>


</dl><p></p></dd>

  <dt id="arg-tol">tol<a class="anchor" aria-label="anchor" href="#arg-tol"></a></dt>
<dd><p>(numeric) tolerance for checking the gradient, scaled
    relative to the curvature (i.e., testing the gradient on a scale
    defined by its Wald standard deviation)</p></dd>

  <dt id="arg-reltol">relTol<a class="anchor" aria-label="anchor" href="#arg-reltol"></a></dt>
<dd><p>(numeric) tolerance for the gradient, scaled
    relative to the magnitude of the estimated coefficient</p></dd>

  <dt id="arg-mod-type">mod.type<a class="anchor" aria-label="anchor" href="#arg-mod-type"></a></dt>
<dd><p>model type (for internal use)</p></dd>

  <dt id="arg-standardize-x">standardize.X<a class="anchor" aria-label="anchor" href="#arg-standardize-x"></a></dt>
<dd><p>scale columns of X matrix? (not yet implemented)</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other elements to include in check specification</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The <code>*Control</code> functions return a list (inheriting from class
  <code>"merControl"</code>) containing</p><ol><li><p>general control parameters, such as <code>optimizer</code>, <code>restart_edge</code>;</p></li>
<li><p>(currently not for <code>nlmerControl</code>:)
    <code>"checkControl"</code>, a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> of data-checking
    specifications, e.g., <code>check.nobs.vs.rankZ</code>;</p></li>
<li><p>parameters to be passed to the optimizer, i.e., the <code>optCtrl</code>
    list, which may contain <code>maxiter</code>.</p></li>
</ol><p><code>.makeCC</code> returns a list containing the check specification
  (action, tolerance, and optionally relative tolerance).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that (only!) the pre-fitting “checking options”
  (i.e., all those starting with <code>"check."</code> but <em>not</em>
  including the convergence checks (<code>"check.conv.*"</code>) or
  rank-checking (<code>"check.rank*"</code>) options)
  may also be set globally via <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></code>.
  In that case, <code>(g)lmerControl</code> will use them rather than the
  default values, but will <em>not</em> override values that are passed as
  explicit arguments.</p>
<p>For example, <code>options(lmerControl=list(check.nobs.vs.rankZ = "ignore"))</code>
  will suppress warnings that the number of observations is less than
  the rank of the random effects model matrix <code>Z</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="convergence.html">convergence</a> and <code><a href="allFit.html">allFit</a>()</code> which fits
  for a couple of optimizers;
  <code><a href="nloptwrap.html">nloptwrap</a></code> for the <code>lmerControl()</code> default optimizer.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">lmerControl</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ optimizer      : chr "nloptwrap"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ restart_edge   : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ boundary.tol   : num 1e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ calc.derivs    : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ use.last.params: logi FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ checkControl   :List of 8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.rankZ: chr "ignore"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.nlev : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nlev.gtreq.5 : chr "ignore"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nlev.gtr.1   : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.nRE  : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.rankX        : chr "message+drop.cols"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.scaleX       : chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.formula.LHS  : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ checkConv      :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.grad    :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 0.002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ relTol: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.singular:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "message"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 1e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.hess    :List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 1e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ optCtrl        : list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - attr(*, "class")= chr [1:2] "lmerControl" "merControl"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="fu">glmerControl</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> List of 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ optimizer      : chr [1:2] "bobyqa" "Nelder_Mead"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ restart_edge   : logi FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ boundary.tol   : num 1e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ calc.derivs    : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ use.last.params: logi FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ checkControl   :List of 9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.rankZ     : chr "ignore"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.nlev      : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nlev.gtreq.5      : chr "ignore"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nlev.gtr.1        : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.nobs.vs.nRE       : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.rankX             : chr "message+drop.cols"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.scaleX            : chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.formula.LHS       : chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.response.not.const: chr "stop"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ checkConv      :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.grad    :List of 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 0.002</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ relTol: NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.singular:List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "message"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 1e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ..$ check.conv.hess    :List of 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ action: chr "warning"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .. ..$ tol   : num 1e-06</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ optCtrl        : list()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ tolPwrss       : num 1e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ compDev        : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  $ nAGQ0initStep  : logi TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - attr(*, "class")= chr [1:2] "glmerControl" "merControl"</span>
<span class="r-in"><span><span class="co">## fit with default algorithm [nloptr version of BOBYQA] ...</span></span></span>
<span class="r-in"><span><span class="va">fm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="lmer.html">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span>   <span class="op">(</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, <span class="va">sleepstudy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="lmer.html">lmer</a></span><span class="op">(</span><span class="va">Reaction</span> <span class="op">~</span> <span class="va">Days</span> <span class="op">+</span> <span class="op">(</span><span class="va">Days</span> <span class="op">|</span> <span class="va">Subject</span><span class="op">)</span>, <span class="va">sleepstudy</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## or with "bobyqa" (default 2013 - 2019-02) ...</span></span></span>
<span class="r-in"><span><span class="va">fm1_bobyqa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm1</span>, control <span class="op">=</span> <span class="fu">lmerControl</span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"bobyqa"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## or with "Nelder_Mead" (the default till 2013) ...</span></span></span>
<span class="r-in"><span><span class="va">fm1_NMead</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm1</span>, control <span class="op">=</span> <span class="fu">lmerControl</span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"Nelder_Mead"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## or with the nlminb function used in older (&lt;1.0) versions of lme4;</span></span></span>
<span class="r-in"><span><span class="co">## this will usually replicate older results</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nashjc/optimx" class="external-link">optimx</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">fm1_nlminb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm1</span>,</span></span>
<span class="r-in"><span>                         control <span class="op">=</span> <span class="fu">lmerControl</span><span class="op">(</span>optimizer<span class="op">=</span> <span class="st">"optimx"</span>,</span></span>
<span class="r-in"><span>                                               optCtrl  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"nlminb"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="co">## The other option here is method="L-BFGS-B".</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: optimx</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Or we can wrap base::optim():</span></span></span>
<span class="r-in"><span><span class="va">optimwrap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fn</span>,<span class="va">par</span>,<span class="va">lower</span>,<span class="va">upper</span>,<span class="va">control</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">control</span><span class="op">$</span><span class="va">method</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"must specify method in optCtrl"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">method</span> <span class="op">&lt;-</span> <span class="va">control</span><span class="op">$</span><span class="va">method</span></span></span>
<span class="r-in"><span>    <span class="va">control</span><span class="op">$</span><span class="va">method</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span>    <span class="co">## "Brent" requires finite upper values (lower bound will always</span></span></span>
<span class="r-in"><span>    <span class="co">##  be zero in this case)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">method</span><span class="op">==</span><span class="st">"Brent"</span><span class="op">)</span> <span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">1e4</span>,<span class="va">upper</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span>par<span class="op">=</span><span class="va">par</span>, fn<span class="op">=</span><span class="va">fn</span>, lower<span class="op">=</span><span class="va">lower</span>,upper<span class="op">=</span><span class="va">upper</span>,</span></span>
<span class="r-in"><span>                 control<span class="op">=</span><span class="va">control</span>,method<span class="op">=</span><span class="va">method</span>,<span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">res</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>par  <span class="op">=</span> <span class="va">par</span>,</span></span>
<span class="r-in"><span>                   fval <span class="op">=</span> <span class="va">value</span>,</span></span>
<span class="r-in"><span>                   feval<span class="op">=</span> <span class="va">counts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                   conv <span class="op">=</span> <span class="va">convergence</span>,</span></span>
<span class="r-in"><span>                   message <span class="op">=</span> <span class="va">message</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">fm0_brent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm0</span>,</span></span>
<span class="r-in"><span>                    control <span class="op">=</span> <span class="fu">lmerControl</span><span class="op">(</span>optimizer <span class="op">=</span> <span class="st">"optimwrap"</span>,</span></span>
<span class="r-in"><span>                                          optCtrl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"Brent"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in getOptfun(optimizer):</span> couldn't find optimizer function optimwrap</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## You can also use functions (in addition to the lmerControl() default "NLOPT_BOBYQA")</span></span></span>
<span class="r-in"><span><span class="co">## from the 'nloptr' package, see also  '?nloptwrap' :</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/astamm/nloptr" class="external-link">nloptr</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">fm1_nloptr_NM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm1</span>, control<span class="op">=</span><span class="fu">lmerControl</span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"nloptwrap"</span>,</span></span>
<span class="r-in"><span>                                      optCtrl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>algorithm<span class="op">=</span><span class="st">"NLOPT_LN_NELDERMEAD"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">fm1_nloptr_COBYLA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fm1</span>, control<span class="op">=</span><span class="fu">lmerControl</span><span class="op">(</span>optimizer<span class="op">=</span><span class="st">"nloptwrap"</span>,</span></span>
<span class="r-in"><span>                                      optCtrl<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>algorithm<span class="op">=</span><span class="st">"NLOPT_LN_COBYLA"</span>,</span></span>
<span class="r-in"><span>                                                   xtol_rel<span class="op">=</span><span class="fl">1e-6</span>,</span></span>
<span class="r-in"><span>                                                   xtol_abs<span class="op">=</span><span class="fl">1e-10</span>,</span></span>
<span class="r-in"><span>                                                   ftol_abs<span class="op">=</span><span class="fl">1e-10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: nloptr</span>
<span class="r-in"><span><span class="co">## other algorithm options include NLOPT_LN_SBPLX</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Douglas Bates, Martin Maechler, Ben Bolker, Steven Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2</p> and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9007.</p>
</div>

    </footer></div>





  </body></html>

